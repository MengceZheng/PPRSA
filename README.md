# Cryptanalysis of Prime Power RSA with two private exponents

## Introduction

This is a Python implementation of lattice-based attack proposed in **Cryptanalysis of Prime Power RSA with two private exponents**[^PPRSA].

## Requirements

- [**SageMath**](https://www.sagemath.org/) 9.5 with Python 3.10

You can check your SageMath Python version using the following command:

```commandline
$ sage -python --version
Python 3.10.12
```

Note: If your SageMath Python version is older than 3.9.0, some features in given scripts might not work.

## Usage

The standard way to run the attack with the specific parameters requires passing them as command line arguments `sage -python attack.py <prime_bit_length> <delta1> <delta2> <r> <s>`. For instance, to run the attack with $\ell=256$, $\delta_1=0.125$, $\delta_2=0.125$, $r=2$ and $s=2$, please run `sage -python attack.py 256 0.125 0.125 2 2`:

```commandline
PPRSA$ sage -python attack.py 256 0.125 0.125 2 2
The parameters:
N = 1000342827376188837057885278088524330523579129692646508535087671207095561166948129438745600969233521199543127508003547525276830047736294731148933485520237398672257720947629794302864551578063121218762368522306841044308765289865431539
e1 = 979946507505960574661948819715689500047510190718283994151628742004440335474340685126460748769736295518556506193678721678091648658403301315645829760770147267844009789681461129290194674899888293158397534247576485556476186735219296127
e2 = 498497010586467857576274782665323185057099168282621769200582067943153662543207018467393390404933215113042671488253298316224139361244655807989621500905466497728117546529557675682636899117040798203829184241741537695751333572839748159
Found private keys:
d1 = 76983399761611348635196534703
d2 = 75150917053223844921411514759
Found primes:
p = 111084988975670708352748493053436434510729089800829382923815547592706155021903
q = 81065881587718589548776982031060416597255737625911843156288208873437502543571
The attack costs 0.141 seconds...
```

For instance, to run the attack with $\ell=128$, $\delta_1=0.3$, $\delta_2=0.3$, $r=3$ and $s=3$, please run `sage -python attack.py 128 0.3 0.3 3 3`:

```commandline
PPRSA$ sage -python attack.py 128 0.3 0.3 3 3
The parameters:
N = 1637801098465064756837626584693779279492863930302923143666317152425785453512953612752829114613842995199265249405525323613233512844600371380150800474809661
e1 = 425075617458727535131697663323391277039946698348517466931184806403009621706981197624782220179103163048641208617015274343428964097060688330501505162725999
e2 = 1477348560303019374843198916576351597127408606544175971217820120303569398275080594062619099379663024310439532745860464935659956252909252969809588118499239
Found private keys:
d1 = 15864221186286312665361670884708876715451011031
d2 = 13309117210740897637930025758026034615719785239
Found primes:
p = 202325645263552670528228746611530189239
q = 197746295186353227243972889019992645819
The attack costs 0.157 seconds...
```

For instance, to run the attack with $\ell=128$, $\delta_1=0.35$, $\delta_2=0.45$, $r=4$ and $s=4$, please run `sage -python attack.py 128 0.35 0.45 4 4`:

```commandline
PPRSA$ sage -python attack.py 128 0.35 0.45 4 4
The parameters:
N = 931978191833823773788452298896798771431673981795309931790139277622055865727158502998598840710990557852295410263599133487620106859595478546681963101096802349277282732730073158670909253935631171
e1 = 55924387548415339402856984981050884443234533045166394825551448343154770293674592835529313250207359324928008449383322582839394905905186229371643373868981751672259753495291609306890060706090687
e2 = 294601308060265273398962137550100664019150512967173055494250101798106845837393225164694458001663877348117567015513573262148133899263560339705719082939664070885512181309851170176790247762170183
Found private keys:
d1 = 20121939563188711328669572957155847020700075330818994507093749918503
d2 = 256873364830439185404590635791526103362890952806468826641531194219086062869863905571667
Found primes:
p = 236582028614103528126462771531925899499
q = 297494365324094894406212320215516389171
The attack costs 0.274 seconds...
```

For instance, to run the attack with $\ell=128$, $\delta_1=0.5$, $\delta_2=0.52$, $r=5$ and $s=7$, please run `sage -python attack.py 128 0.5 0.52 5 7`:

```commandline
PPRSA$ sage -python attack.py 128 0.5 0.52 5 7
The parameters:
N = 145067229159448202484122808683118279445452685697842583982223381195861337607813963906793010369785160743556464410576174618377640923751557095639054927982771056088857451683576545902402838454926142092795767573207628279414900408039904601
e1 = 29571779355579336348790397281323865131177359872654345499333469649580507096328731353172015113285938397920126995010946609763251815000991192999380119841933965833291780251787919261513425384600065113964925863050912768320172804766987827
e2 = 91413045309896228231563809444624772560612779018054585021041480090866272724465317585788288833351579263654284446439316253468351751082764843059540248518840013434332262845626990721045972823359324508736027997648378949311401666093556079
Found private keys:
d1 = 29048426800600870405631383683843518321219249246992747167477034334957060053544485340746971185166448663013084678332727
d2 = 2511266763174195412119750433888475437276414726817077559134068461210825402080548107848909309431115433018409270323387860027
Found primes:
p = 226193774692645076961548379896506323743
q = 244999994971275835430350316689024512007
The attack costs 3.257 seconds...
```

## Notes

All the details of the numerical attack experiments are recorded in the `attack.log` file. A more efficient lattice reduction algorithm [flatter](https://github.com/keeganryan/flatter) is used and `USE_FLATTER = True`.

[^PPRSA]: Zheng M., Hu H., "Cryptanalysis of Prime Power RSA with two private exponents" | [PDF](https://mengcezheng.github.io/docs/ZH15.pdf)
